/** ! created at <%= grunt.template.today("yyyy-mm-dd") by cqb %> */
define(["module","react","react-dom","classnames","moment","utils/Dom","utils/ClickAway","core/BaseComponent","Clock"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function l(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),n=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},o=b.PropTypes,p=function(a){function g(a){j(this,g);var b=k(this,Object.getPrototypeOf(g).call(this,a)),c={time:0,date:1,month:2,year:3};b.view=a.view||"datetime";var d="datetime"!=b.view?a.view:"date",f=0,h=3;return a.timeOnly&&(b.view=d="time",h=0),a.dateOnly&&(f=1,b.view="date"),a.monthOnly&&(b.view=d="month",f=2),a.yearOnly&&(b.view=d="year",f=3),b.minStage=f,b.maxStage=h,b.addState({stage:c[d],visibility:!1,value:a.value,current:e(a.value),startDate:!!b.props.startDate&&e(b.props.startDate),endDate:!!b.props.endDate&&e(b.props.endDate)}),b}return l(g,a),m(g,[{key:"formatValue",value:function(a){if(this.props.format)return e(a).format(this.props.format);var b=this.view,c=null;return"datetime"===b&&(c="YYYY-MM-DD HH:mm:ss"),"date"===b&&(c="YYYY-MM-DD"),"time"===b&&(c="HH:mm:ss"),"month"===b&&(c="YYYY-MM-01"),"year"===b&&(c="YYYY-01-01"),c?e(a).format(c):""}},{key:"componentClickAway",value:function(){this.hide()}},{key:"show",value:function(){var a=this;if(!this.props.readOnly&&!this.props.disabled){var b=c.findDOMNode(this.refs.datePicker);b.style.display="block";var d=f.closest(b,".cm-datetime"),h=f.getOuterHeight(b)+5,i=f.overView(d,h);f.withoutTransition(d,function(){a.setState({dropup:i})});var j=e();this.state.visibility||(n(Object.getPrototypeOf(g.prototype),"show",this).call(this),setTimeout(function(){a.setState({current:e(a.state.value)||j}),a.bindClickAway()},0))}}},{key:"hide",value:function(){n(Object.getPrototypeOf(g.prototype),"hide",this).call(this),this.unbindClickAway(),"datetime"===this.view&&"time"===this.state.stage&&this.setState({stage:1})}},{key:"dayChange",value:function(a){var b=this;this.setState({value:this.formatValue(a),current:a}),this.emit("selectDate",a.toDate()),0==this.minStage?setTimeout(function(){b.setState({stage:0})},0):this.hide()}},{key:"yearChange",value:function(a){var b=this,c=this.state.current;c.set({year:a,date:1});var d=void 0;d=3==this.minStage?{value:this.formatValue(c),current:c}:{stage:2,current:c},setTimeout(function(){b.setState(d)},0),this.emit("selectYear",a)}},{key:"monthChange",value:function(a){var b=this,c=this.state.current;c.set({month:a,date:1});var d=void 0;d=2==this.minStage?{value:this.formatValue(c),current:c}:{stage:1,current:c},setTimeout(function(){b.setState(d)},0),this.emit("selectMonth",a)}},{key:"timeChange",value:function(a){var b=this;a=a.time;var c=this.state.current;c.set({hour:a.get("hour"),minute:a.get("minute"),second:a.get("second")}),setTimeout(function(){b.setState({current:c,value:c.format("YYYY-MM-DD HH:mm:ss")})},0),this.emit("selectTime",c.format("HH:mm:ss"))}},{key:"stageChange",value:function(a){var b=this;a<this.minStage||a>this.maxStage||(this.state.stage===a&&(a=1),window.setTimeout(function(){b.setState({stage:a})},0))}},{key:"prev",value:function(){var a=this.state.stage,b=void 0;1==a&&(b=this.state.current.add(-1,"month")),2==a&&(b=this.state.current.add(-1,"year")),this.setState({current:b})}},{key:"next",value:function(){var a=this.state.stage,b=void 0;1==a&&(b=this.state.current.add(1,"month")),2==a&&(b=this.state.current.add(1,"year")),this.setState({current:b})}},{key:"renderDays",value:function(){for(var a,c=this.state.value,f=e(this.state.current),g=f.year(),h=f.month(),i=e(f.set("date",1)),j=e(i).add(1,"months").add(-1,"days"),k=1-i.weekday(),l=7*Math.ceil((j.get("date")-k+1)/7),m=[],n=0;n<l;n++){var o=e(i);a=o.add(n+k,"days"),m.push(a)}var p=!!c&&(g===e(c).get("year")&&h===e(c).get("month")),q=this.state.startDate,r=this.state.endDate;return m.map(function(a,f){var g=this,i=!!(q&&e(a.format(q._f)).diff(q)<0);i=i||!!(r&&e(a.format(r._f)).diff(r)>0);var j=d("day",{disabled:i,gray:a.get("month")!==h,today:p&&e(c).get("date")===a.get("date")&&e(c).get("month")===a.get("month")});return b.createElement("button",{type:"button",onClick:function(){g.dayChange(a)},key:f,className:j},a.get("date"))},this)}},{key:"renderYears",value:function(){for(var a=this,c=e(this.state.current),d=c.get("year"),f=[],g=function(c){f.push(b.createElement("button",{type:"button",onClick:function(){a.yearChange(c)},key:c,className:"year"},c))},h=d-12;h<d+13;h++)g(h);return f}},{key:"renderMonths",value:function(){for(var a=this,c=e(this.state.current),d=(c.get("year"),c.get("month"),[]),f=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],g=function(c){d.push(b.createElement("button",{type:"button",onClick:function(){a.monthChange(c)},key:c,className:"month"},f[c]))},h=0;h<12;h++)g(h);return d}},{key:"timeClose",value:function(){"time"!==this.view&&this.setState({stage:1})}},{key:"renderClock",value:function(){return b.createElement(i,{ref:"clock",view:this.view,value:this.state.current,onChange:this.timeChange.bind(this),onTimeClose:this.timeClose.bind(this)})}},{key:"clear",value:function(){this.setState({value:null})}},{key:"today",value:function a(){var b=e(this.state.value),a=e();if("datetime"===this.view){var c=b.get("hour"),d=b.get("minute"),f=b.get("second");a.set("hour",c),a.set("minute",d),a.set("second",f)}this.setState({value:a,current:e(a)}),this.emit("selectDate",e(a).toDate())}},{key:"_getWeek",value:function(){return["日","一","二","三","四","五","六"].map(function(a,c){return b.createElement("div",{key:c,className:"week"},a)})}},{key:"_getHeader",value:function(a){var c=this;if(0==this.state.stage)return"";var d=3==this.state.stage?null:b.createElement("a",{className:"prev",onClick:this.prev.bind(this)},b.createElement("i",{className:"fa fa-chevron-left"})),e=3==this.state.stage?null:b.createElement("a",{className:"next",onClick:this.next.bind(this)},b.createElement("i",{className:"fa fa-chevron-right"})),f=this.state.stage>1?null:b.createElement("a",{className:"month",onClick:function(){c.stageChange(2)}},a.format("MM"));return b.createElement("div",{style:this.props.style,className:"date-picker-header"},d,b.createElement("a",{className:"year",onClick:function(){c.stageChange(3)}},a.format("YYYY")),f,e)}},{key:"_getFooter",value:function(){return 1==this.state.stage&&this.props.tools?b.createElement("div",{className:"date-picker-footer"},b.createElement("a",{className:"clear",onClick:this.clear.bind(this)},"清除"),b.createElement("a",{className:"today-btn",onClick:this.today.bind(this)},"今天")):""}},{key:"_getView",value:function(){switch(this.state.stage){case 1:var a=this._getWeek(),c=this.renderDays();return b.createElement("div",{className:"inner"},a,c);case 3:var d=this.renderYears();return b.createElement("div",{className:"inner"},d);case 2:var e=this.renderMonths();return b.createElement("div",{className:"inner"},e);case 0:var f=this.renderClock();return b.createElement("div",{className:"inner"},f)}}},{key:"setStartDate",value:function(a){this.setState({startDate:e(a)})}},{key:"setEndDate",value:function(a){this.setState({endDate:e(a)})}},{key:"setValue",value:function(a){this.setState({value:a,current:e(a)})}},{key:"getValue",value:function(){return this.state.value}},{key:"render",value:function(){var a=d(this.props.className,"cm-datetime",this.state.theme,{disabled:this.props.disabled||this.props.readOnly,active:this.state.active&&!this.props.readOnly,dropup:this.state.dropup}),c=this.state.value?this.formatValue(this.state.value):"";c=c?b.createElement("span",{className:"date-text"},c):b.createElement("span",{className:"date-text"},this.props.placeholder," ");var f=e(this.state.current),g=this._getHeader(f),h=this._getView(),i=this._getFooter();return b.createElement("div",{ref:"datetime",onClick:this.show.bind(this),className:a,style:this.props.style||{}},c,b.createElement("i",{className:"fa fa-calendar"}),b.createElement("div",{className:"cm-datetime-wrap",ref:"datePicker",style:{display:this.state.visibility?"block":"none"}},b.createElement("div",{className:"date-picker"},g,h,i)))}}]),g}(h);p=g(p),p.propTypes={className:o.string,style:o.object,disabled:o.bool,readOnly:o.bool,value:o.oneOfType([o.string,o.instanceOf(e)]),view:o.oneOf(["datetime","date","time"]),format:o.string,startDate:o.oneOfType([o.string,o.instanceOf(e)]),endDate:o.oneOfType([o.string,o.instanceOf(e)])},a.exports=p});