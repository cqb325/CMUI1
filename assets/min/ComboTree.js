/** ! created at <%= grunt.template.today("yyyy-mm-dd") by cqb %> */
define(["module","react","react-dom","classnames","core/BaseComponent","Core","core/Ajax","utils/ClickAway","utils/Dom","utils/grids","FormControl","Tree"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function o(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),q=b.PropTypes,r=j.getGrid,s=function(a){function e(a){m(this,e);var b=n(this,Object.getPrototypeOf(e).call(this,a));return b.selectedItems={},b.addState({value:a.value,active:!1,data:a.data}),b.showOptions=b.showOptions.bind(b),b.hideOptions=b.hideOptions.bind(b),b}return o(e,a),p(e,[{key:"_renderValues",value:function(){var a=this.selectedItems[this.state.value],c=a?a.text:this.props.placeholder?this.props.placeholder+"&nbsp;":"&nbsp;",e=d("cm-select-value",{placeholder:!a&&this.props.placeholder}),f=c+'<input type="hidden" name="'+this.props.name+'" value="'+this.state.value+'">';return b.createElement("span",{className:e,dangerouslySetInnerHTML:{__html:f}})}},{key:"_selectItem",value:function(a){var b="id",c=null;a?this.props.multi?(this.selectedItems[a[b]]=a,c=this.getSelectedValues()):(c=a[b],this.selectedItems={},this.selectedItems[c]=a):this.props.multi||this.hideOptions(),this.setState({value:c}),this.props.onChange&&this.props.onChange(c,a),this.emit("change",c,a)}},{key:"getSelectedValues",value:function(){if(this.selectedItems){var a=[];for(var b in this.selectedItems)a.push(b);return a.join(",")}return""}},{key:"getValue",value:function(){return this.getSelectedValues()}},{key:"setValue",value:function(a){this.selectedItems[a.id]=a,this.setState({value:a.id})}},{key:"componentClickAway",value:function(){this.hideOptions()}},{key:"showOptions",value:function(){var a=this;if(!this.props.readOnly&&!this.props.disabled){var b=c.findDOMNode(this.refs.options);b.style.display="block";var d=i.closest(b,".cm-select"),e=i.getOuterHeight(b)+5,f=i.overView(d,e);i.withoutTransition(d,function(){a.setState({dropup:f})}),this.bindClickAway(),setTimeout(function(){a.setState({active:!0})},0)}}},{key:"hideOptions",value:function(){var a=this;this.setState({active:!1});var b=c.findDOMNode(this.refs.options);this.unbindClickAway();var d=500;this.isLtIE9()&&(d=0),setTimeout(function(){a.state.active===!1&&(b.style.display="none")},d)}},{key:"setData",value:function(a){this.setState({data:a,value:""})}},{key:"getReference",value:function(){return this.refs.tree}},{key:"componentWillMount",value:function(){var a=this;this.props.url&&!function(){var b=a;g.get(a.props.url,{},function(a){a&&b.setState({data:a})})}()}},{key:"render",value:function(){var a=this.props,c=a.className,e=a.disabled,f=a.readOnly,g=a.style,h=a.grid;c=d("cm-select",r(h),{active:this.state.active,disabled:e||f,dropup:this.state.dropup,hasEmptyOption:this.props.hasEmptyOption});var i=this._renderValues();return b.createElement("div",{className:c,style:g,onClick:this.showOptions},i,b.createElement("span",{className:"cm-select-cert"}),b.createElement("div",{className:"cm-select-options-wrap"},b.createElement("div",{ref:"options",className:"cm-select-options"},b.createElement(l,{ref:"tree",data:this.state.data,onSelect:this._selectItem.bind(this)}))))}}]),e}(e);s=h(s),s.propTypes={data:q.oneOfType([q.array,q.object]),value:q.string,className:q.string,disabled:q.bool,readOnly:q.bool,multi:q.bool,style:q.object,choiceText:q.string,placeholder:q.string},k&&k.register(s,"combotree"),a.exports=s});