/** ! created at <%= grunt.template.today("yyyy-mm-dd") by cqb %> */
define(["module","react","classnames","core/BaseComponent","utils/grids","utils/omit","utils/regs","utils/Validation","Label"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function l(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var m=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},n=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),o=(e.getGrid,b.PropTypes),p=function(a){function d(a){j(this,d);var b=k(this,Object.getPrototypeOf(d).call(this,a));return b.displayName="FormControl",b.rules=a.rules||{},b.messages=a.messages||{},b._isFormItem=void 0==a.isFormItem||a.isFormItem,b._name=a.name,b._areaLabel=!1,b._tipAlign=a.tipAlign||"right",a.required&&(b.rules.required=!0),b.addState({errorTip:""}),b.item=null,b}return l(d,a),n(d,[{key:"_getControl",value:function(a){var c=null;if(a){c=d.COMPONENTS[a],c||(c=d.COMPONENTS.text);var e=f(this.props,["className","children","layout","rules","messages","isFormItem","onValid","onChange","label","labelGrid"]),g=m({type:this.props.type,key:this.props.name,id:this.props.id,ref:"formItem","data-valueType":c.valueType},e),h=c.component.name||c.component.toString().match(/function\s*([^(]*)\(/)[1];"Input"===h?g["data-handleChange"]=this.handleChange.bind(this):"TextArea"===h?(this._areaLabel=!0,g["data-handleChange"]=this.handleChange.bind(this)):g.onChange=this.onChange.bind(this),c=b.createElement(c.component,g)}return c}},{key:"_renderChildren",value:function(){var a=this,c=this.props.children;return b.Children.map(c,function(c,d){var e=a.isRegisterComponent(c);if(e){var g=f(a.props,["className","children","layout","rules","messages","isFormItem","onValid","onChange","label","labelGrid"]),h=m({key:d,"data-valueType":e.valueType,ref:"formItem"},g);h=m(h,c.props);var i=c.type.name||c.type.toString().match(/function\s*([^(]*)\(/)[1];return"Input"===i||"TextArea"===i?(h["data-handleChange"]=a.handleChange.bind(a),"TextArea"===i&&(a._areaLabel=!0)):h.onChange=a.onChange.bind(a),b.cloneElement(c,h)}return c})}},{key:"isRegisterComponent",value:function(a){for(var b in d.COMPONENTS){var c=d.COMPONENTS[b];if(c.component==a.type)return c}return!1}},{key:"handleChange",value:function(a){var b=this.props,c=b.readOnly,d=b.type,e=b.trigger;if(!c){this.props.autoHeight&&this.autoHeight(a),this.item||(this.item=this.refs.formItem),d=d||this.item.props.type;var f=a.target.value;if(!f||"integer"!==d&&"number"!==d||g[d].test(f)||(f=this.state.value||""),this.item.setState({value:f}),e&&e==a.type){this.check(f);this.props.onChange&&this.props.onChange(f)}}}},{key:"onChange",value:function(a){this.check(a);this.props.onChange&&this.props.onChange(a)}},{key:"check",value:function(a){a||(a=this.item.getValue());var b=this.rules,c=this.messages,d=void 0,e=void 0;if(!b.required&&(null==a||""==a||void 0==a))return this.state.errorTip&&this.setState({errorTip:null}),!0;if("array"===this.item.props.valueType&&(a=a?a.split(","):[]),console.log(a),b.required&&(d={method:"required",parameters:b.required},e=this.validByMethod(a,d,c),0==e))return!1;for(var f in b)if("required"!==f&&(d={method:f,parameters:b[f]},e=this.validByMethod(a,d,c),0==e))return!1;return this.props.onValid&&this.props.onValid(a,!0,this),this.emit("valid",a,!0,this),this.setState({errorTip:null}),!0}},{key:"validByMethod",value:function(a,b,c){var d=b.method;if(!h.methods[d])return void console.error("验证中缺少"+d+"方法");var e,f=h.methods[d].call(this,a,b.parameters);return 0==f&&(e=c&&c[d]?c[d]:h.messages[d],"function"==typeof e&&(e=e.call(null,b.parameters)),this.setState({errorTip:e}),this.props.onValid&&this.props.onValid(a,f,this),this.emit("valid",a,f,this)),f}},{key:"renderErrorTip",value:function(){if(this.state.errorTip){var a=c("error-tip",this._tipAlign);return b.createElement("span",{className:a},this.state.errorTip)}return null}},{key:"componentDidMount",value:function(){this.item=this.refs.formItem,this.props["data-itemBind"]&&this.isFormItem()&&this.props["data-itemBind"]({ref:this,name:this.props.name,isFormItem:this.isFormItem()})}},{key:"isValid",value:function(){return!this.state.errorTip}},{key:"getValue",value:function(){return this.item.getValue()}},{key:"setValue",value:function(a){this.item.setValue(a)}},{key:"getName",value:function(){return this._name}},{key:"isFormItem",value:function(){return this._isFormItem}},{key:"setErrorTip",value:function(a){this.setState({errorTip:a})}},{key:"setRule",value:function(a,b){this.rules[a]=b}},{key:"setMessage",value:function(a,b){this.messages[a]=b}},{key:"render",value:function(){var a=this.props,d=a.label,e=a.labelGrid,f=a.type,g=a.layout,h=a.className,j=a.style,k=(a.children,a.required);h=c("cm-form-group",h,{inline:"inline"===g,invalid:!!this.state.errorTip});var l=c("cm-form-label",{required:k||this.required}),m=this._getControl(f),n=this.renderErrorTip(),o=this._renderChildren(),p=null;return d&&("inline"===g&&(p=b.createElement(i,{className:l,component:"label",grid:e,style:this._areaLabel?{verticalAlign:"top"}:{}},d)),"stack"===g&&(p=b.createElement(i,{className:l,grid:e,style:this._areaLabel?{verticalAlign:"top"}:{}},d))),b.createElement("div",{className:h,style:j},p,m,o,n)}}]),d}(d);p.defaultProps={layout:"inline",trigger:"blur"},p.COMPONENTS={},p.register=function(a,b,c){b instanceof Array?b.forEach(function(b){"number"!=b&&"integer"!=b&&"tel"!=b||(c="number"),p.COMPONENTS[b]={component:a,valueType:c||"string"}}):p.COMPONENTS[b]={component:a,valueType:c||"string"}},p.propTypes={type:o.string,name:o.string,layout:o.string,label:o.string,placeholder:o.string,labelGrid:o.oneOfType([o.string,o.number]),rules:o.object,messages:o.object,className:o.string,style:o.object,isFormItem:o.bool,required:o.bool,onValid:o.func,onChange:o.func,tipAlign:o.string},a.exports=p});