/** ! created at <%= grunt.template.today("yyyy-mm-dd") by cqb %> */
define(["module","react","react-dom","utils/Dom","internal/CircleRipple"],function(a,b,c,d,e){"use strict";function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function i(a,b){var c=Array.isArray(b)?b:[b];return p(a,{$push:c})}function j(a){return p(a,{$splice:[[0,1]]})}var k=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=b.Component,n=b.PropTypes,o=b.addons.TransitionGroup,p=b.addons.update,q=function(a){function m(a,c){f(this,m);var d=g(this,Object.getPrototypeOf(m).call(this,a,c));return d.handleMouseUp=function(){d.end()},d.handleMouseLeave=function(){d.end()},d.handleTouchStart=function(a){a.stopPropagation(),d.props.abortOnScroll&&a.touches&&(d.startListeningForScrollAbort(a),d.startTime=Date.now()),d.start(a,!0)},d.handleTouchEnd=function(){d.end()},d.handleTouchMove=function(a){var c=Math.abs(Date.now()-d.startTime);if(c>300)return void d.stopListeningForScrollAbort();var e=Math.abs(a.touches[0].clientY-d.firstTouchY),f=Math.abs(a.touches[0].clientX-d.firstTouchX);if(e>6||f>6){var g=d.state.ripples,h=g[0],k=b.cloneElement(h,{aborted:!0});g=j(g),g=i(g,k),d.setState({ripples:g},function(){d.end()})}},d.ignoreNextMouseDown=!1,d.state={hasRipples:!1,nextKey:0,ripples:[]},d}return h(m,a),l(m,[{key:"start",value:function(a,c){if(this.ignoreNextMouseDown&&!c)return void(this.ignoreNextMouseDown=!1);var d=this.state.ripples;d=i(d,b.createElement(e,{key:this.state.nextKey,style:this.props.centerRipple?{}:this.getRippleStyle(a),color:this.props.color||"rgba(255, 255, 255, .25)",opacity:this.props.opacity||1,touchGenerated:c})),this.ignoreNextMouseDown=c,this.setState({hasRipples:!0,nextKey:this.state.nextKey+1,ripples:d})}},{key:"end",value:function(){var a=this.state.ripples;this.setState({ripples:j(a)}),this.props.abortOnScroll&&this.stopListeningForScrollAbort()}},{key:"handleMouseDown",value:function(a){0===a.button&&this.start(a,!1)}},{key:"startListeningForScrollAbort",value:function(a){this.firstTouchY=a.touches[0].clientY,this.firstTouchX=a.touches[0].clientX,document.addEventListener&&document.body.addEventListener("touchmove",this.handleTouchMove)}},{key:"stopListeningForScrollAbort",value:function(){document.removeEventListener&&document.body.removeEventListener("touchmove",this.handleTouchMove)}},{key:"getRippleStyle",value:function(a){var b={},e=c.findDOMNode(this),f=e.parentNode.parentNode.offsetHeight,g=e.parentNode.parentNode.offsetWidth,h=d.offset(e.parentNode.parentNode),i=a.touches&&a.touches.length,j=i?a.touches[0].pageX:a.pageX,k=i?a.touches[0].pageY:a.pageY,l=j-h.left,m=k-h.top,n=this.calcDiag(l,m),o=this.calcDiag(g-l,m),p=this.calcDiag(g-l,f-m),q=this.calcDiag(l,f-m),r=Math.max(n,o,p,q),s=2*r,t=l-r,u=m-r;return b.height=s+"px",b.width=s+"px",b.top=u+"px",b.left=t+"px",b}},{key:"calcDiag",value:function(a,b){return Math.sqrt(a*a+b*b)}},{key:"render",value:function(){var a=this.props,c=a.children,d=a.style,f=this.state,g=f.hasRipples,h=f.ripples,j=void 0,l=k({height:"100%",width:"100%",position:"absolute",top:0,left:0,overflow:"hidden"},d);return g?j=b.createElement(o,{style:l},h):(h=i(h,b.createElement(e,{key:this.state.nextKey-1,color:this.props.color||"rgba(255, 255, 255, .25)",opacity:0,touchGenerated:!1,aborted:!0})),j=b.createElement(o,{style:l},h)),b.createElement("div",{onMouseUp:this.handleMouseUp,onMouseDown:this.handleMouseDown.bind(this),onMouseLeave:this.handleMouseLeave,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,style:d},j,c)}}]),m}(m);q.propTypes={abortOnScroll:n.bool,centerRipple:n.bool,children:n.node,color:n.string,opacity:n.number,style:n.object},q.defaultProps={abortOnScroll:!0},a.exports=q});