/** ! created at <%= grunt.template.today("yyyy-mm-dd") by cqb %> */
define(["module","react","react-dom","Core","classnames","FontIcon","core/BaseComponent"],function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function i(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function j(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=b.Component,m=b.PropTypes,n=function(a){function c(a){h(this,c);var b=i(this,Object.getPrototypeOf(c).call(this,a));return b.state={pageNum:a.current},b}return j(c,a),k(c,[{key:"render",value:function(){var a=e("prev",{disabled:1==this.state.pageNum});return b.createElement("li",{onClick:this.props.onClick,className:a},b.createElement("a",{href:"javascript:void(0)"},b.createElement(f,{icon:"angle-left"})))}}]),c}(l),o=function(a){function c(){return h(this,c),i(this,Object.getPrototypeOf(c).apply(this,arguments))}return j(c,a),k(c,[{key:"render",value:function(){var a=e("next",{disabled:this.props.disabled});return b.createElement("li",{onClick:this.props.onClick,className:a},b.createElement("a",{href:"javascript:void(0)"},b.createElement(f,{icon:"angle-right"})))}}]),c}(l),p=function(a){function c(){return h(this,c),i(this,Object.getPrototypeOf(c).apply(this,arguments))}return j(c,a),k(c,[{key:"render",value:function(){var a=e({active:this.props.active});return b.createElement("li",{onClick:this.props.onClick,className:a},b.createElement("a",{href:"javascript:void(0)"},this.props.currentIndex))}}]),c}(l),q=function(a){function d(a){h(this,d);var b=i(this,Object.getPrototypeOf(d).call(this,a));return b.addState({current:a.current,_current:a.current,pageSize:a.pageSize,total:a.total,displayedPages:5,displayInfo:void 0==b.props.displayInfo||b.props.displayInfo}),b}return j(d,a),k(d,[{key:"update",value:function(a){var b={};if(void 0!=a.pageSize&&(b.pageSize=a.pageSize),void 0!=a.displayedPages&&(b.displayedPages=a.displayedPages),void 0!=a.total&&(b.total=a.total),void 0!=a.current){b.current=a.current,b._current=a.current;var c=a.pageSize||this.state.pageSize,d=a.total||this.state.total;if(b.current>this._calcPage(c,d))return this.setState(b),void this._changePageSize(c,!0)}this.setState(b)}},{key:"_calcPage",value:function(a,b){var c=a;return"undefined"==typeof c&&(c=this.state.pageSize),b=b||this.state.total,Math.floor((b-1)/c)+1}},{key:"_isValid",value:function(a){return"number"==typeof a&&a>=1&&a!==this.state.current}},{key:"_selectPageSize",value:function(){this._changePageSize(parseInt(c.findDOMNode(this.refs.pageSize).value))}},{key:"_changePageSize",value:function(a,b){var d=this.state.current;"number"==typeof a&&(this.setState({pageSize:a}),this.state.current>this._calcPage(a)&&(d=this._calcPage(a)||1,this.setState({current:d,_current:d}),this.refs.pageNum&&(c.findDOMNode(this.refs.pageNum).value=d))),b||(this.props.onShowSizeChange?(this.props.onShowSizeChange(d,a),this.emit("showSizeChange",d,a)):this.goToPage())}},{key:"_handleChange",value:function(a){var b=a;return this._isValid(b)?(b>this._calcPage()&&(b=this._calcPage()),"current"in this.props||this.setState({current:b,_current:b}),this.update({current:b}),this.props.onChange&&this.props.onChange(b,this.state.pageSize),this.emit("change",b,this.state.pageSize),this.refs.pageNum&&(c.findDOMNode(this.refs.pageNum).value=b),b):this.state.current}},{key:"goToPage",value:function(){var a=parseInt(c.findDOMNode(this.refs.pageNum).value);this._isValid(a)&&a<=this._calcPage()&&this.props.onChange&&this.props.onChange(a,this.state.pageSize)}},{key:"_prev",value:function(){this._hasPrev()&&this._handleChange(this.state.current-1)}},{key:"_next",value:function(){this._hasNext()&&this._handleChange(this.state.current+1)}},{key:"_hasPrev",value:function(){return this.state.current>1}},{key:"_hasNext",value:function(){return this.state.current<this._calcPage()}},{key:"_jumpPrev",value:function(){this._handleChange(Math.max(1,this.state.current-5))}},{key:"_jumpNext",value:function(){this._handleChange(Math.min(this._calcPage(),this.state.current+5))}},{key:"_getInterval",value:function(){var a=this.state,b=this._calcPage(),c=a.displayedPages,d=c/2;return{start:Math.ceil(a.current>d?Math.max(Math.min(a.current-d,b-c),0):0),end:Math.ceil(a.current>d?Math.min(a.current+d,b):Math.min(d,b))}}},{key:"render",value:function(){var a=this._calcPage(),c=[],d=this.state.current,f=this._getInterval();if(a<=9)for(var g=0;g<a;g++){var h=d===g+1;c.push(b.createElement(p,{key:g+1,onClick:this._handleChange.bind(this,g+1),active:h,currentIndex:g+1}))}else{for(var i=2,j=Math.min(i,f.start),k=0;k<j;k++)c.push(b.createElement(p,{key:k+1,onClick:this._handleChange.bind(this,k+1),currentIndex:k+1}));i<f.start&&f.start-i!=1?c.push(b.createElement("li",{key:"...1",className:"disabled"},b.createElement("span",{className:"ellipse"},"•••"))):f.start-i==1&&c.push(b.createElement(p,{key:i+1,onClick:this._handleChange.bind(this,i+1),currentIndex:i+1}));for(var l=f.start;l<f.end;l++){var m=d===l+1;c.push(b.createElement(p,{key:l+1,onClick:this._handleChange.bind(this,l+1),currentIndex:l+1,active:m}))}if(f.end<a&&i>0){a-i>f.end&&a-i-f.end!=1?c.push(b.createElement("li",{key:"...2",className:"disabled"},b.createElement("span",{className:"ellipse"},"•••"))):a-i-f.end==1&&c.push(b.createElement(p,{key:f.end+1,onClick:this._handleChange.bind(this,f.end+1),currentIndex:f.end+1}));for(var q=Math.max(a-i,f.end),r=q;r<a;r++)c.push(b.createElement(p,{key:r+1,onClick:this._handleChange.bind(this,r+1),currentIndex:r+1}))}}var s=e("cm-pagination",this.state.theme,this.props.className,this.props.shape);return b.createElement("div",{className:s},b.createElement("ul",{style:{float:"left"}},b.createElement(n,{current:d,onClick:this._prev.bind(this,null)}),c,b.createElement(o,{current:d,onClick:this._next.bind(this,null),disabled:d==a})),this.state.displayInfo?b.createElement("div",{className:"pagination-info"},b.createElement("span",{className:"ml-10"},"共",a,"页")," ",b.createElement("span",{className:"page-code"},"每页",b.createElement("select",{name:"pageSize",className:"pageSize",value:this.state.pageSize,ref:"pageSize",onChange:this._selectPageSize.bind(this,null)},b.createElement("option",{value:"10"},"10"),b.createElement("option",{value:"50"},"50"),b.createElement("option",{value:"100"},"100")),"条")," ",b.createElement("span",{className:"page-code"},"到第 ",b.createElement("input",{name:"pageNum",className:"pageNum",ref:"pageNum",autoComplete:"off",value:this.state.current,onChange:this.goToPage.bind(this,null),type:"text",style:{width:"40px"}}),"页")):null)}}]),d}(g);q.propTypes={current:m.number,total:m.number,pageSize:m.number},a.exports=q});