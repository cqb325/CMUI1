/** ! created at <%= grunt.template.today("yyyy-mm-dd") by cqb %> */
define(["module","react","react-dom","classnames","moment","utils/Dom","core/BaseComponent","Clock"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function j(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function k(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=b.PropTypes,n=function(a){function c(a){i(this,c);var b=j(this,Object.getPrototypeOf(c).call(this,a)),d={time:0,date:1,month:2,year:3};b.view=a.view||"datetime";var f="datetime"!=b.view?a.view:"date",g=0,h=3;return a.timeOnly&&(b.view=f="time",h=0),a.dateOnly&&(g=1,b.view="date"),a.monthOnly&&(b.view=f="month",g=2),a.yearOnly&&(b.view=f="year",g=3),b.minStage=g,b.maxStage=h,b.maxRange=a.maxRange||0,b.addState({stage:d[f],value:a.value,format:a.format,current:e(a.value),startDate:!!a.startDate&&e(a.startDate),endDate:!!a.endDate&&e(a.endDate),prevBtn:a.prevBtn||!0,nextBtn:a.nextBtn||!0,selectedRange:[]}),b}return k(c,a),l(c,[{key:"setMonthOnly",value:function(){this.minStage=2,this.maxStage=3,this.setState({stage:2})}},{key:"setYearOnly",value:function(){this.minStage=3,this.maxStage=3,this.setState({stage:3})}},{key:"setDateOnly",value:function(){this.minStage=1,this.maxStage=3,this.setState({stage:1})}},{key:"setTimeOnly",value:function(){this.minStage=0,this.maxStage=0,this.setState({stage:0})}},{key:"setFormat",value:function(a){this.state.format!==a&&this.setState({format:a})}},{key:"show",value:function(){var a=e();this.setState({current:e(this.state.value)||a})}},{key:"formatValue",value:function(a){if(this.state.format)return e(a).format(this.state.format);var b=this.view,c=null;return"datetime"===b&&(c="YYYY-MM-DD HH:mm:ss"),"date"===b&&(c="YYYY-MM-DD"),"time"===b&&(c="HH:mm:ss"),"month"===b&&(c="YYYY-MM-01"),"year"===b&&(c="YYYY-01-01"),c?e(a).format(c):""}},{key:"dayChange",value:function(a){var b=this,c=this.formatValue(a);a.isSame(this.state.current,"month")||this.emit("selectMonth",a.get("month")),this.setState({value:c,current:a}),this.valueChange(c,a.toDate()),0==this.minStage?setTimeout(function(){b.setState({stage:0})},0):this.emit("hide")}},{key:"valueChange",value:function(a,b){this.emit("selectDate",a,b),this.props.onSelectDate&&this.props.onSelectDate(a,b)}},{key:"yearChange",value:function(a){var b=this,c=this.state.current;c.set({year:a,date:1});var d=void 0;if(3==this.minStage){var e=this.formatValue(c);d={value:e,current:c},this.valueChange(e,c.toDate()),this.emit("hide")}else d={stage:2,current:c};setTimeout(function(){b.setState(d)},0),this.emit("selectYear",a)}},{key:"monthChange",value:function(a){var b=this,c=this.state.current;c.set({month:a,date:1});var d=void 0;if(2==this.minStage){var e=this.formatValue(c);d={value:this.formatValue(c),current:c},this.valueChange(e,c.toDate()),this.emit("hide")}else d={stage:1,current:c};setTimeout(function(){b.setState(d)},0),this.emit("selectMonth",a)}},{key:"timeChange",value:function(a){var b=this;a=a.time;var c=this.state.current;c.set({hour:a.get("hour"),minute:a.get("minute"),second:a.get("second")}),setTimeout(function(){b.setState({current:c,value:c.format("YYYY-MM-DD HH:mm:ss")})},0),this.valueChange(c.format("YYYY-MM-DD HH:mm:ss"),c.toDate()),this.emit("selectTime",c.format("HH:mm:ss"))}},{key:"hoverDay",value:function(a){this.emit("hoverDay",a)}},{key:"stageChange",value:function(a){var b=this;a<this.minStage||a>this.maxStage||(this.state.stage===a&&(a=1),window.setTimeout(function(){b.setState({stage:a})},0))}},{key:"prev",value:function(){var a=this.state.stage,b=void 0;1==a&&(b=this.state.current.add(-1,"month")),2==a&&(b=this.state.current.add(-1,"year")),this.setState({current:b}),this.emit("selectPrev",b)}},{key:"next",value:function(){var a=this.state.stage,b=void 0;1==a&&(b=this.state.current.add(1,"month")),2==a&&(b=this.state.current.add(1,"year")),this.setState({current:b}),this.emit("selectNext",b)}},{key:"renderDays",value:function(){for(var a,c=this.state.value,f=e(this.state.current),g=f.year(),h=f.month(),i=e(f.set("date",1)),j=e(i).add(1,"months").add(-1,"days"),k=1-i.weekday(),l=7*Math.ceil((j.get("date")-k+1)/7),m=[],n=0;n<l;n++){var o=e(i);a=o.add(n+k-1,"days"),m.push(a)}var p=!!c&&(g===e(c).get("year")&&h===e(c).get("month")),q=this.state.startDate,r=this.state.endDate,s=this.state.selectedRange,t=void 0,u=void 0;s&&s.length&&(t=e(s[0]),u=e(s[1]),p=!1);var v=void 0==this.props.completion||this.props.completion;return m.map(function(a,f){var g=this,i=!!(q&&e(a.format(q._f)).diff(q)<0);i=i||!!(r&&e(a.format(r._f)).diff(r)>0);var j=!1;t&&(t.isBefore(a)||t.isSame(a,"day")&&t.isSame(a,"month")&&t.isSame(a,"year"))&&(a.isBefore(u)||u.isSame(a,"day")&&u.isSame(a,"month")&&u.isSame(a,"year"))&&(j=!0);var k=d("day",{disabled:i,gray:a.get("month")!==h,today:p&&e(c).get("date")===a.get("date")&&e(c).get("month")===a.get("month"),rangeSelect:j});return v||a.get("month")===h?b.createElement("button",{type:"button",onClick:function(){g.dayChange(a)},onMouseOver:function(){g.hoverDay(a)},key:f,className:k},a.get("date")):b.createElement("button",{type:"button",key:f,className:"day empty"})},this)}},{key:"renderYears",value:function(){for(var a=this,c=e(this.state.current),d=c.get("year"),f=[],g=function(c){f.push(b.createElement("button",{type:"button",onClick:function(){a.yearChange(c)},key:c,className:"year"},c))},h=d-12;h<d+13;h++)g(h);return f}},{key:"renderMonths",value:function(){for(var a=this,c=e(this.state.current),f=c.get("year"),g=(c.get("month"),this.state.startDate),h=this.state.endDate,i=[],j=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],k=function(c){var e=!1;g&&(g.get("year")>f&&(e=!0),g.get("year")==f&&g.get("month")>c&&(e=!0)),h&&(h.get("year")<f&&(e=!0),h.get("year")==f&&h.get("month")<c&&(e=!0));var k=d("month",{disabled:e});i.push(b.createElement("button",{type:"button",onClick:function(){a.monthChange(c)},key:c,className:k},j[c]))},l=0;l<12;l++)k(l);return i}},{key:"timeClose",value:function(){"time"!==this.view&&this.setState({stage:1})}},{key:"renderClock",value:function(){return b.createElement(h,{ref:"clock",view:this.view,value:this.state.current,onChange:this.timeChange.bind(this),onTimeClose:this.timeClose.bind(this)})}},{key:"clear",value:function(){this.setState({value:null})}},{key:"today",value:function a(){var b=e(this.state.value),a=e();if("datetime"===this.view){var c=b.get("hour"),d=b.get("minute"),f=b.get("second");a.set("hour",c),a.set("minute",d),a.set("second",f)}this.setState({value:a,current:e(a)}),this.emit("selectDate",e(a).toDate())}},{key:"_getWeek",value:function(){return["日","一","二","三","四","五","六"].map(function(a,c){return b.createElement("div",{key:c,className:"week"},a)})}},{key:"_getHeader",value:function(a){var c=this;if(0==this.state.stage)return"";var d=3!=this.state.stage&&this.state.prevBtn?b.createElement("a",{className:"prev",onClick:this.prev.bind(this)},b.createElement("i",{className:"fa fa-chevron-left"})):null,e=3!=this.state.stage&&this.state.nextBtn?b.createElement("a",{className:"next",onClick:this.next.bind(this)},b.createElement("i",{className:"fa fa-chevron-right"})):null,f=this.state.stage>1?null:b.createElement("a",{className:"month",onClick:function(){c.stageChange(2)}},a.format("MM"));return b.createElement("div",{style:this.props.style,className:"date-picker-header"},d,b.createElement("a",{className:"year",onClick:function(){c.stageChange(3)}},a.format("YYYY")),f,e)}},{key:"_getFooter",value:function(){return 1==this.state.stage&&this.props.tools?b.createElement("div",{className:"date-picker-footer"},b.createElement("a",{className:"clear",onClick:this.clear.bind(this)},"清除"),b.createElement("a",{className:"today-btn",onClick:this.today.bind(this)},"今天")):""}},{key:"_getView",value:function(){switch(this.state.stage){case 1:var a=this._getWeek(),c=this.renderDays();return b.createElement("div",{className:"inner"},a,c);case 3:var d=this.renderYears();return b.createElement("div",{className:"inner"},d);case 2:var e=this.renderMonths();return b.createElement("div",{className:"inner"},e);case 0:var f=this.renderClock();return b.createElement("div",{className:"inner"},f)}}},{key:"setStartDate",value:function(a){this.setState({startDate:e(a)})}},{key:"setEndDate",value:function(a){this.setState({endDate:e(a)})}},{key:"setValue",value:function(a){this.setState({value:a,current:e(a)})}},{key:"getValue",value:function(){return this.state.value}},{key:"render",value:function(){var a=d(this.props.className,"date-picker"),c=e(this.state.current),f=this._getHeader(c),g=this._getView(),h=this._getFooter();return b.createElement("div",{className:a,style:this.props.style},f,g,h)}}]),c}(g);n.propTypes={className:m.string,style:m.object,disabled:m.bool,readOnly:m.bool,value:m.oneOfType([m.string,m.instanceOf(e)]),view:m.oneOf(["datetime","date","time"]),format:m.string,startDate:m.oneOfType([m.string,m.instanceOf(e)]),endDate:m.oneOfType([m.string,m.instanceOf(e)]),timeOnly:m.bool,dateOnly:m.oneOfType([m.bool,m.string]),monthOnly:m.oneOfType([m.bool,m.string]),yearOnly:m.oneOfType([m.bool,m.string]),minStage:m.number,maxStage:m.number,prevBtn:m.bool,nextBtn:m.bool},a.exports=n});